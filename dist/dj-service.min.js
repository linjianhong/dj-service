"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();!function(e,t,n){e.module("dj-localStorage-table",[]).factory("LocalStorageTable",["$q",function(n){return function(){function o(e){_classCallCheck(this,o),this.tableName=e,this.initTable()}return _createClass(o,[{key:"initTable",value:function(){var e=this,n=t.localStorage.getItem(this.tableName)||JSON.stringify({rows:[]});this.data=JSON.parse(n),this.rows=this.data.rows,this.maxId=0,this.rows.map(function(t){t.id>e.maxId&&(e.maxId=t.id)})}},{key:"autoInsertId",value:function(){return++this.maxId}},{key:"saveToLocalStorage",value:function(){t.localStorage.removeItem(this.tableName),t.localStorage.setItem(this.tableName,JSON.stringify(this.data))}},{key:"insert",value:function(t,o){var r=this.autoInsertId();return this.rows.push(e.extend({id:r},t)),!o&&this.saveToLocalStorage(),n.when(r)}},{key:"select",value:function(t){t=t||{};var o=this.rows.filter(function(e){for(var n in t)if(e[n]!=t[n])return!1;return!0});return n.when(e.merge([],o))}},{key:"update",value:function(t,o,r){var i=this;t=t||{};var a=this.rows.filter(function(e){for(var n in t)if(e[n]!=t[n])return!1;return!0});return a[0]?(e.extend(a[0],o),this.saveToLocalStorage(),n.when(e.merge({},a[0]))):r?this.insert(e.extend({},t,o)).then(function(e){return i.rows.find(function(t){return t.id==e})}):n.reject("无此数据")}}]),o}()}])}(angular,window),function(e,t,n){function o(t,n){return e.extend({errcode:0,datas:t},n)}function r(t,n,o){return e.extend({errcode:t,errmsg:n},o)}var i=e.module("dj-http",[]);i.config(["$httpProvider",function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var n=function e(t){var n,o,r,i,a,s,u,c="";for(n in t)if((o=t[n])instanceof Array)for(u=0;u<o.length;++u)a=o[u],r=n+"["+u+"]",s={},s[r]=a,c+=e(s)+"&";else if(o instanceof Object)for(i in o)a=o[i],r=n+"["+i+"]",s={},s[r]=a,c+=e(s)+"&";else void 0!==o&&null!==o&&(c+=encodeURIComponent(n)+"="+encodeURIComponent(o)+"&");return c.length?c.substr(0,c.length-1):c};t.defaults.transformRequest=[function(t){return e.isObject(t)&&"[object File]"!==String(t)?n(t):t}]}]),i.config(["$qProvider",function(e){e.errorOnUnhandledRejections(!1)}]);var a;i.run(["$q","$http",function(t,n){a=function(e){if(!(this instanceof a))return new a(e);this.data=e};var i={$q:t,$http:n,OK:function(e,t){return a.resolve(o(e,t))},error:function(e,t,n){return a.reject(r(e,t,n))},reject:function(e){return this instanceof a?(this.data=t.reject(e),this):new a(t.reject(e))},resolve:function(e){return this instanceof a?(this.data=t.when(e),this):new a(t.when(e))}};e.extend(a,i),a.prototype=i}]),i.provider("sign",[function(){function e(e){u=e,/\/$/.test(u)||(u+="/")}function t(e){t.fn=e}function n(e){n.fn=e}function i(e){for(var n,o,r=c.length;r--;){var i=c[r];if(i.match&&i.hookRequest&&(o=e.url.match(i.match))&&(n=i.hookRequest(e,a,o)))return n}return t.fn(e,a)}function s(e,t){for(var o,r=c.length;r--;){var i=c[r];if(i.match&&i.hookResponse&&e.config.urlBase.match(i.match)&&(o=i.hookResponse(e,t)))return o}return n.fn(e,t)}var u="./";this.setApiRoot=e;var c=[],f=this.registerHttpHook=function(e){return c.indexOf(e)<0&&c.push(e),e};this.unRegisterHttpHook=function(e){c.splice(c.indexOf(e),1)},this.registerDefaultRequestHook=t,this.registerDefaultRequestHook(function(e,t){var n=e.url,o=e.data;return/^(http(s)?\:)?\/\//.test(n)||(n=u+n),{url:n,data:o}}),this.registerDefaultResponseHook=n,this.registerDefaultResponseHook(function(e,t){return t.when(e.data).then(function(e){return e&&0==+e.errcode?e:t.reject(e)})}),this.$get=function(){return{setApiRoot:e,registerDefaultRequestHook:t,registerHttpHook:f,OK:o,error:r,hookRequest:i,hookResponse:s,apiRoot:u||"./"}}}]),i.factory("DJHttpHook",["$q","$rootScope","sign",function(e,t,n){return{request:function(t){if(t.urlBase=t.url,"POST"!=t.method||!1===t.hook)return t;var o=t.hook||{};if(!1===o.hookRequest)return t;var r=n.hookRequest(t,a);return r instanceof a?e.reject(r):("url"==o.hookRequest?t.url=r.url:"sign"==o.hookRequest?t.data=r.post:(t.data=r.post,t.url=r.url),t)},requestError:function(t){return e.reject(t)},response:function(t){return"POST"!=t.config.method||!1===t.config.hook?t:!1===(t.config.hook||{}).hookResponse?t:n.hookResponse(t,e)},responseError:function(t){return t instanceof a?e.when(t.data):e.reject(t)}}}]),i.config(["$httpProvider",function(e){e.interceptors.push("DJHttpHook")}])}(angular,window),function(e,t,n){var o,r=/micromessenger/i.test(navigator.userAgent),i=location.origin.length>12&&location.origin.indexOf("192.168")<0&&r,a=e.module("wx-jssdk",[]),s=8e4;a.run(["$http","$q",function(e,n){o=function(){if(!i)return n.reject("not wx");if(o.promise)return n.when(o.promise);var r=n.defer(),a=t.theSiteConfig&&t.theSiteConfig.wx_app.wx.name||"pgy-wx",s=location.href.split("#")[0];return e.post("app/jsapi_sign",{name:a,url:encodeURIComponent(s)}).then(function(e){var t=e.datas.config;if(!t)return void r.reject("config error!");wx.config({debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","translateVoice","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","closeWindow","scanQRCode","chooseWXPay"]}),wx.ready(function(){r.resolve(o.promise=wx)})}).catch(function(e){r.reject("getWjSign error!")}),o.promise=r.promise}}]),a.run(["$rootScope","$http","$q","sign",function(e,n,r,i){i.registerHttpHook({match:/^扫描二维码$/,hookRequest:function(e,t){var n=r.defer();return o().then(function(e){e.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var t=e.resultStr;n.resolve(t)},fail:function(e){n.reject(e)}})}).catch(function(e){n.resolve("10"+ ++s)}),t.resolve(n.promise)}}),i.registerHttpHook({match:/^模拟扫描二维码$/,hookRequest:function(e,n){var o=r.defer();return t.setTimeout(function(){o.resolve(e.data||"模拟数据")},120),n.resolve(o.promise)}})}])}(angular,window);